# VPC IPv4 CIDRブロック選択ガイド

VPCを作成する際のIPv4 CIDRブロックの選択方法について説明します。

## 推奨値

### 標準的な推奨値

**`10.0.0.0/16`** を推奨します。

このCIDRブロックは：
- **利用可能なIPアドレス数**: 65,536個（2^16）
- **範囲**: 10.0.0.0 ～ 10.0.255.255
- **一般的な用途**: 中規模から大規模なアプリケーションに適している

### その他の選択肢

#### 小規模なアプリケーション向け
- **`10.0.0.0/24`**: 256個のIPアドレス（10.0.0.0 ～ 10.0.0.255）
  - 非常に小規模な環境向け
  - サブネットを1つしか作成しない場合

#### 中規模なアプリケーション向け（推奨）
- **`10.0.0.0/16`**: 65,536個のIPアドレス（10.0.0.0 ～ 10.0.255.255）
  - 複数のサブネットを作成可能
  - 将来の拡張に対応しやすい
  - **バリアナビアプリケーションには最適**

#### 大規模なアプリケーション向け
- **`10.0.0.0/8`**: 16,777,216個のIPアドレス（10.0.0.0 ～ 10.255.255.255）
  - 非常に大規模な環境向け
  - 複数のVPCやオンプレミス環境との接続を考慮する場合

## CIDRブロックの表記方法

CIDRブロックは以下の形式で指定します：
```
<ネットワークアドレス>/<プレフィックス長>
```

### プレフィックス長の意味

| プレフィックス長 | 利用可能IP数 | 使用例 |
|----------------|------------|--------|
| /24 | 256 | 小規模な単一サブネット |
| /20 | 4,096 | 中規模な複数サブネット |
| /16 | 65,536 | **推奨：中規模アプリケーション** |
| /12 | 1,048,576 | 大規模な複数サブネット |
| /8 | 16,777,216 | 非常に大規模な環境 |

## バリアナビアプリケーションでの推奨構成

### VPC CIDRブロック
```
10.0.0.0/16
```

### サブネット構成例

VPC内に以下のサブネットを作成することを推奨します：

| サブネット | CIDRブロック | 用途 | 可用性ゾーン |
|-----------|------------|------|------------|
| パブリックサブネット1 | 10.0.1.0/24 | ALB、NAT Gateway | ap-northeast-1a |
| パブリックサブネット2 | 10.0.2.0/24 | ALB、NAT Gateway | ap-northeast-1c |
| プライベートサブネット1 | 10.0.10.0/24 | ECSタスク | ap-northeast-1a |
| プライベートサブネット2 | 10.0.11.0/24 | ECSタスク | ap-northeast-1c |
| DBサブネット1 | 10.0.20.0/24 | RDS | ap-northeast-1a |
| DBサブネット2 | 10.0.21.0/24 | RDS | ap-northeast-1c |

この構成により：
- 各サブネットに256個のIPアドレスを割り当て
- 高可用性のためのマルチAZ構成
- 将来の拡張に対応可能

## 注意事項

### 1. プライベートIPアドレス範囲を使用

以下のRFC 1918で定義されたプライベートIPアドレス範囲を使用してください：

- **10.0.0.0/8** (10.0.0.0 ～ 10.255.255.255)
- **172.16.0.0/12** (172.16.0.0 ～ 172.31.255.255)
- **192.168.0.0/16** (192.168.0.0 ～ 192.168.255.255)

**推奨**: `10.0.0.0/16` を使用（最も一般的で、オンプレミス環境との競合が少ない）

### 2. 既存のVPCやオンプレミスネットワークとの重複を避ける

VPCのCIDRブロックは、以下のネットワークと重複しないようにしてください：
- 既存のVPC
- オンプレミスネットワーク（VPN接続する場合）
- 他のAWSアカウントのVPC（VPCピアリングする場合）

### 3. CIDRブロックの変更は不可

VPCを作成した後、CIDRブロックを変更することはできません。十分なサイズを確保してください。

### 4. AWSが予約するIPアドレス

各サブネットで、AWSは以下のIPアドレスを予約します：
- **最初の4つのIPアドレス**: ネットワーク、ルーター、DNS、将来の使用
- **最後の1つのIPアドレス**: ブロードキャスト

例：`10.0.1.0/24`の場合、実際に使用できるのは251個のIPアドレスです。

## AWS Consoleでの設定方法

1. **VPC Console**に移動
2. 「VPCを作成」をクリック
3. **IPv4 CIDRブロック**に以下を入力：
   ```
   10.0.0.0/16
   ```
4. 「VPCを作成」をクリック

## AWS CLIでの設定方法

```bash
# VPCを作成（推奨設定）
aws ec2 create-vpc \
    --cidr-block 10.0.0.0/16 \
    --region ap-northeast-1

# タグを付ける
aws ec2 create-tags \
    --resources vpc-xxxxxxxxx \
    --tags Key=Name,Value=barrier-navi-vpc
```

## まとめ

**バリアナビアプリケーションには `10.0.0.0/16` を推奨します。**

この設定により：
- ✅ 十分なIPアドレス数（65,536個）
- ✅ 複数のサブネットを作成可能
- ✅ 将来の拡張に対応可能
- ✅ 一般的で互換性が高い
- ✅ オンプレミス環境との競合が少ない

## 参考リンク

- [AWS VPC公式ドキュメント](https://docs.aws.amazon.com/vpc/)
- [VPCとサブネットのサイジング](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html#vpc-sizing-ipv4)
- [RFC 1918 - プライベートIPアドレス](https://tools.ietf.org/html/rfc1918)
