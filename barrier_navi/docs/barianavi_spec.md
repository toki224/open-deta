# バリアナビ仕様書（身体障害者向け画面）

## 1. コンセプト
- **目的**: 「この駅は自分に合うか」という外出前の不安を軽減し、利用可能な駅を素早く把握できるようにする。
- **対象**: 身体障害（特に車いす利用者、肢体不自由者）を中心に、設備の充実度を知りたいユーザー。

## 2. 画面フロー

1. **ホーム_身体（一覧画面）**
   - 駅検索バー（駅名入力）
   - 駅カードリスト（駅名＋総合スコア `例: 8/17点`）
   - 絞り込み機能パネル
     - 障害カテゴリ切替（身体/聴覚/視覚）
     - 都道府県フィルタ
     - バリアフリー項目の重み付け選択（高/中/低）
2. **詳細画面**
   - 駅の基本情報（鉄道事業者、路線、所在地 など）
   - 身体障害向け設備一覧表
   - 内訳表示パネル（棒グラフ/円グラフなど）
   - 合計値・おすすめ度表示
   - アクションボタン（例: お気に入り登録、乗換案内リンク）

## 3. データ項目（身体障害カテゴリ）
身体障害ユーザーが重視する 15 項目を以下に定義する。スコア計算や絞り込みに利用する。

| No | 項目名 | DB カラム例 | 備考 |
| -- | -- | -- | -- |
| 1 | 段差への対応 | `step_response_status` | 1=○, 2=×, 3=- |
| 2 | 案内設備の設置 | `has_guidance_system` | 1=○ |
| 3 | 障害者対応型便所の設置 | `has_accessible_restroom` | 1=○ |
| 4 | 障害者対応型改札口の設置 | `has_accessible_gate` | 1=○ |
| 5 | 転落防止設備の設置 | `has_fall_prevention` | 1=○ |
| 6 | プラットホーム数 | `num_platforms` | 数値 |
| 7 | 段差解消済みホーム数 | `num_step_free_platforms` | 数値 |
| 8 | エレベーター設置基数 | `num_elevators` | 数値 |
| 9 | 適合エレベーター基数 | `num_compliant_elevators` | 数値 |
| 10 | エスカレーター設置基数 | `num_escalators` | 数値 |
| 11 | 適合エスカレーター基数 | `num_compliant_escalators` | 数値 |
| 12 | その他の昇降機設置基数 | `num_other_lifts` | 数値 |
| 13 | 傾斜路設置箇所数 | `num_slopes` | 数値 |
| 14 | 適合傾斜路設置箇所数 | `num_compliant_slopes` | 数値 |
| 15 | 車いす乗降可能ホーム数 | `num_wheelchair_accessible_platforms` | 数値 |

## 4. スコアリング

### 4.1 基本式
- 各項目 `i` の達成度 `score_i = current_i / required_i` （二値項目は 1 or 0）
- 利用者が設定する重み `weight_i` を反映し、総合スコアを算出:
  ```
  total_score = Σ(score_i * weight_i) / Σ(weight_i)
  ```
- 表示は `達成アイテム数 / 必要アイテム数`（例: 8/17 点）に加え、%や評価ラベル（A/B/C）も検討。

### 4.2 必要値（例）
| 項目 | required_i (初期値案) |
| --- | --- |
| プラットホーム数 | 6 |
| 段差解消ホーム数 | 6 |
| エレベーター基数 | 4 |
| 適合エレベーター基数 | 4 |
| エスカレーター基数 | 4 |
| 適合エスカレーター基数 | 4 |
| その他の昇降機 | 2 |
| 傾斜路 | 2 |
| 適合傾斜路 | 2 |
| 車いす乗降可能ホーム数 | 6 |
| 二値項目 | 1 (装備があれば達成) |

※ 必要値は将来的に管理画面や設定ファイルから変更可能なようにする。

## 5. API 設計（ドラフト）

| メソッド | エンドポイント | 説明 |
| --- | --- | --- |
| GET | `/api/stations/body` | 身体障害カテゴリ用の駅リスト。検索・フィルタ・重み付けをクエリパラメータで受け取る。 |
| GET | `/api/stations/{id}/body` | 指定駅の身体障害向け詳細情報。設備内訳とスコアを返す。 |

### 5.1 クエリパラメータ例
- `keyword`: 駅名検索
- `prefecture`: 都道府県
- `weights`: JSON 文字列または `weight_step=3&weight_guidance=2` 形式
- `limit`, `offset`: ページネーション

### 5.2 レスポンス例
```json
{
  "success": true,
  "data": [
    {
      "station_id": 1,
      "station_name": "東京",
      "score": {
        "total": 8,
        "max": 17,
        "percentage": 0.47
      },
      "highlights": [
        "適合エレベーター 22 基",
        "車いす対応ホーム 11/11"
      ]
    }
  ]
}
```

## 6. フロントエンド要件

- **一覧カード**
  - 駅名、スコア（例: `8/17 点`）、進捗バー
  - クリックで詳細遷移
- **絞り込みパネル**
  - 障害カテゴリ切替ボタン
  - 都道府県セレクタ
  - バリアフリー項目リスト（高/中/低）。設定値は API へ送信。
- **詳細画面**
  - 情報表 (15 項目)
  - 内訳グラフ (例: レーダーチャート)
  - 合計値カード
  - 行動ボタン（お気に入り、シェア等）

## 7. 今後のタスク例
1. 必要値テーブルの確定と DB or 設定ファイル化
2. スコア計算ロジックの実装（バックエンド）
3. API 実装＆テスト
4. フロント UI コンポーネント作成（一覧・詳細・フィルタ）
5. ユーザーテスト／フィードバック反映

---
この仕様書を基に、他カテゴリ（視覚/聴覚）にも拡張予定。

